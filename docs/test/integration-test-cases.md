# 結合テストケース

このドキュメントでは、Bonsai Appの結合テストケースを定義します。結合テストは、システムの複数のコンポーネントが正しく連携して動作することを確認するために実施されます。

## 目次

1. [テスト環境](#テスト環境)
2. [認証テスト](#認証テスト)
3. [盆栽管理テスト](#盆栽管理テスト)
4. [作業記録テスト](#作業記録テスト)
5. [作業予定テスト](#作業予定テスト)
6. [オフライン機能テスト](#オフライン機能テスト)
7. [パフォーマンステスト](#パフォーマンステスト)

## テスト環境

### 前提条件

- テスト環境（dev）にデプロイされたアプリケーション
- テスト用のユーザーアカウント（管理者、一般ユーザー）
- テスト用のデータセット（プロジェクト、タスク）
- E2Eテスト用のCypress環境

### テスト実行方法

1. テスト環境にアクセス: `https://dev.bonsai-app.example.com`
2. Cypressテストの実行: `npm run cypress:open`
3. テスト結果の確認: Cypressダッシュボードまたはテストレポート

## 認証テスト

### TC-AUTH-001: ユーザー登録

**目的**: 新規ユーザーが正常に登録できることを確認する

**前提条件**:
- テスト用のメールアドレス（未登録）

**テストステップ**:
1. アプリケーションのサインアップページにアクセスする
2. 必要な情報（名前、メールアドレス、パスワード）を入力する
3. サインアップボタンをクリックする
4. 確認コード入力画面が表示されることを確認する
5. テスト用メールアドレスに送信された確認コードを入力する
6. 確認ボタンをクリックする

**期待結果**:
- ユーザーが正常に登録される
- ログイン画面にリダイレクトされる
- 成功メッセージが表示される

### TC-AUTH-002: ユーザーログイン

**目的**: 登録済みユーザーが正常にログインできることを確認する

**前提条件**:
- 登録済みのテストユーザーアカウント

**テストステップ**:
1. アプリケーションのログインページにアクセスする
2. メールアドレスとパスワードを入力する
3. ログインボタンをクリックする

**期待結果**:
- ユーザーが正常にログインされる
- ダッシュボード画面にリダイレクトされる
- ユーザー情報が正しく表示される

### TC-AUTH-003: パスワードリセット

**目的**: ユーザーがパスワードを忘れた場合に正常にリセットできることを確認する

**前提条件**:
- 登録済みのテストユーザーアカウント

**テストステップ**:
1. アプリケーションのログインページにアクセスする
2. 「パスワードを忘れた場合」リンクをクリックする
3. メールアドレスを入力する
4. 送信ボタンをクリックする
5. テスト用メールアドレスに送信されたリセットコードを入力する
6. 新しいパスワードを入力する
7. パスワード変更ボタンをクリックする

**期待結果**:
- パスワードが正常に変更される
- ログイン画面にリダイレクトされる
- 成功メッセージが表示される
- 新しいパスワードでログインできる

### TC-AUTH-004: ログアウト

**目的**: ユーザーが正常にログアウトできることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション

**テストステップ**:
1. アプリケーションのヘッダーメニューからログアウトオプションを選択する

**期待結果**:
- ユーザーセッションが終了する
- ログイン画面にリダイレクトされる
- 保護されたページにアクセスできなくなる

## 盆栽管理テスト

### TC-BONSAI-001: 盆栽登録

**目的**: ユーザーが新しい盆栽を登録できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション

**テストステップ**:
1. ダッシュボード画面から「新規盆栽」ボタンをクリックする
2. 盆栽名、樹種、登録日、来歴を入力する
3. 画像をアップロードする
4. 保存ボタンをクリックする

**期待結果**:
- 盆栽が正常に登録される
- 盆栽一覧に新しい盆栽が表示される
- 成功メッセージが表示される

### TC-BONSAI-002: 盆栽編集

**目的**: ユーザーが既存の盆栽情報を編集できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用の盆栽

**テストステップ**:
1. 盆栽一覧から対象の盆栽を選択する
2. 編集ボタンをクリックする
3. 盆栽名、樹種、登録日、来歴を変更する
4. 保存ボタンをクリックする

**期待結果**:
- 盆栽情報が正常に更新される
- 変更された情報が盆栽詳細画面に反映される
- 成功メッセージが表示される

### TC-BONSAI-003: 盆栽削除

**目的**: ユーザーが既存の盆栽を削除できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用の盆栽

**テストステップ**:
1. 盆栽一覧から対象の盆栽を選択する
2. 削除ボタンをクリックする
3. 確認ダイアログで「削除」を選択する

**期待結果**:
- 盆栽が正常に削除される
- 盆栽一覧から削除された盆栽が表示されなくなる
- 成功メッセージが表示される

### TC-BONSAI-004: 盆栽詳細表示

**目的**: 盆栽詳細画面に正しい情報が表示されることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用の盆栽（作業記録と作業予定を含む）

**テストステップ**:
1. 盆栽一覧から対象の盆栽をクリックする

**期待結果**:
- 盆栽詳細画面が表示される
- 盆栽名、樹種、登録日、来歴が正しく表示される
- 盆栽の画像が正しく表示される
- 基本情報タブに最新の作業記録が表示される

### TC-BONSAI-005: 盆栽詳細画面の作業記録タブ表示

**目的**: 盆栽詳細画面の作業記録タブに登録済みの作業記録が正しく表示されることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用の盆栽
- テスト用の作業記録（複数）

**テストステップ**:
1. 盆栽一覧から対象の盆栽をクリックする
2. 作業記録タブをクリックする

**期待結果**:
- 作業記録タブが表示される
- 作業記録一覧が日付の降順で表示される
- 各作業記録の作業タイプと日付が正しく表示される
- 作業記録をクリックすると、作業記録詳細画面に遷移する

## 作業記録テスト

### TC-RECORD-001: 作業記録登録

**目的**: ユーザーが新しい作業記録を登録できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用の盆栽

**テストステップ**:
1. 盆栽詳細画面から「作業記録を追加」ボタンをクリックする
2. 作業タイプ、日付、作業内容を入力する
3. 画像をアップロードする
4. 保存ボタンをクリックする

**期待結果**:
- 作業記録が正常に登録される
- 盆栽詳細画面の作業記録タブに新しい作業記録が表示される
- 成功メッセージが表示される

### TC-RECORD-002: 作業記録編集

**目的**: ユーザーが既存の作業記録を編集できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用の作業記録

**テストステップ**:
1. 作業記録一覧から対象の作業記録を選択する
2. 編集ボタンをクリックする
3. 作業タイプ、日付、作業内容を変更する
4. 保存ボタンをクリックする

**期待結果**:
- 作業記録が正常に更新される
- 変更された情報が作業記録詳細画面に反映される
- 成功メッセージが表示される

### TC-RECORD-003: 作業記録削除

**目的**: ユーザーが既存の作業記録を削除できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用の作業記録

**テストステップ**:
1. 作業記録一覧から対象の作業記録を選択する
2. 削除ボタンをクリックする
3. 確認ダイアログで「削除」を選択する

**期待結果**:
- 作業記録が正常に削除される
- 作業記録一覧から削除された作業記録が表示されなくなる
- 成功メッセージが表示される

## 作業予定テスト

### TC-SCHEDULE-001: 作業予定登録

**目的**: ユーザーが新しい作業予定を登録できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用の盆栽

**テストステップ**:
1. 盆栽詳細画面から「作業予定を追加」ボタンをクリックする
2. 作業タイプ、予定日、作業内容を入力する
3. 保存ボタンをクリックする

**期待結果**:
- 作業予定が正常に登録される
- 盆栽詳細画面の作業予定タブに新しい作業予定が表示される
- 成功メッセージが表示される

### TC-SCHEDULE-002: 作業予定編集

**目的**: ユーザーが既存の作業予定を編集できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用の作業予定

**テストステップ**:
1. 作業予定一覧から対象の作業予定を選択する
2. 編集ボタンをクリックする
3. 作業タイプ、予定日、作業内容を変更する
4. 保存ボタンをクリックする

**期待結果**:
- 作業予定が正常に更新される
- 変更された情報が作業予定詳細画面に反映される
- 成功メッセージが表示される

### TC-SCHEDULE-003: 作業予定削除

**目的**: ユーザーが既存の作業予定を削除できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用の作業予定

**テストステップ**:
1. 作業予定一覧から対象の作業予定を選択する
2. 削除ボタンをクリックする
3. 確認ダイアログで「削除」を選択する

**期待結果**:
- 作業予定が正常に削除される
- 作業予定一覧から削除された作業予定が表示されなくなる
- 成功メッセージが表示される

## 通知テスト

### TC-NOTIF-001: タスク割り当て通知

**目的**: タスクが割り当てられた際に通知が正しく送信されることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション（ユーザーA）
- 別のテストユーザー（ユーザーB）

**テストステップ**:
1. ユーザーAがタスクを作成し、担当者としてユーザーBを選択する
2. ユーザーBのアカウントでログインする

**期待結果**:
- ユーザーBの通知一覧に新しいタスク割り当て通知が表示される
- 通知の内容がタスクの詳細と一致する
- 通知をクリックすると、対応するタスク詳細画面に遷移する

### TC-NOTIF-002: タスク期限通知

**目的**: タスクの期限が近づいた際に通知が正しく送信されることを確認する

**前提条件**:
- テスト用のタスク（期限が設定されている）
- タスクの担当者としてログイン済みのテストユーザーセッション

**テストステップ**:
1. タスクの期限を現在時刻から24時間後に設定する
2. システム時間を23時間進める（テスト環境で模擬）

**期待結果**:
- ユーザーの通知一覧に期限間近の通知が表示される
- 通知の内容がタスクの詳細と一致する
- 通知をクリックすると、対応するタスク詳細画面に遷移する

## オフライン機能テスト

### TC-OFFLINE-001: オフライン編集

**目的**: オフライン状態でデータを編集し、オンライン復帰時に同期されることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用のプロジェクトとタスク

**テストステップ**:
1. ネットワーク接続を切断する（ブラウザのデベロッパーツールで模擬）
2. タスクのステータスを変更する
3. ネットワーク接続を復元する
4. アプリケーションを数秒間操作する

**期待結果**:
- オフライン状態でタスクのステータスが変更できる
- オンライン復帰時に変更が自動的にサーバーと同期される
- 同期完了後、他のブラウザセッションでも変更が反映される

### TC-OFFLINE-002: オフライン作成

**目的**: オフライン状態で新しいデータを作成し、オンライン復帰時に同期されることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用のプロジェクト

**テストステップ**:
1. ネットワーク接続を切断する（ブラウザのデベロッパーツールで模擬）
2. 新しいタスクを作成する
3. ネットワーク接続を復元する
4. アプリケーションを数秒間操作する

**期待結果**:
- オフライン状態で新しいタスクが作成できる
- オンライン復帰時に新しいタスクが自動的にサーバーと同期される
- 同期完了後、他のブラウザセッションでも新しいタスクが表示される

## パフォーマンステスト

### TC-PERF-001: ページロード時間

**目的**: 各主要ページのロード時間が許容範囲内であることを確認する

**前提条件**:
- テスト環境にデプロイされたアプリケーション
- パフォーマンス測定ツール（Lighthouse、WebPageTest等）

**テストステップ**:
1. 以下の各ページにアクセスし、ロード時間を測定する
   - ログインページ
   - ダッシュボード
   - プロジェクト一覧
   - プロジェクト詳細
   - タスク詳細

**期待結果**:
- 初回ロード時間: 3秒以内
- キャッシュ済みロード時間: 1秒以内
- First Contentful Paint: 1.5秒以内
- Time to Interactive: 3.5秒以内

### TC-PERF-002: 大量データ処理

**目的**: アプリケーションが大量のデータを効率的に処理できることを確認する

**前提条件**:
- テスト環境にデプロイされたアプリケーション
- 大量のテストデータ（100プロジェクト、1000タスク）

**テストステップ**:
1. プロジェクト一覧ページにアクセスする
2. タスク一覧ページにアクセスする
3. フィルタリングと検索機能を使用する

**期待結果**:
- プロジェクト一覧の表示時間: 2秒以内
- タスク一覧の表示時間: 2秒以内
- フィルタリング操作のレスポンス時間: 1秒以内
- ページネーションのレスポンス時間: 1秒以内
- メモリ使用量が許容範囲内である
