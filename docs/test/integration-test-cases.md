# 結合テストケース

このドキュメントでは、Bonsai Appの結合テストケースを定義します。結合テストは、システムの複数のコンポーネントが正しく連携して動作することを確認するために実施されます。

## 目次

1. [テスト環境](#テスト環境)
2. [認証テスト](#認証テスト)
3. [プロジェクト管理テスト](#プロジェクト管理テスト)
4. [タスク管理テスト](#タスク管理テスト)
5. [通知テスト](#通知テスト)
6. [オフライン機能テスト](#オフライン機能テスト)
7. [パフォーマンステスト](#パフォーマンステスト)

## テスト環境

### 前提条件

- テスト環境（dev）にデプロイされたアプリケーション
- テスト用のユーザーアカウント（管理者、一般ユーザー）
- テスト用のデータセット（プロジェクト、タスク）
- E2Eテスト用のCypress環境

### テスト実行方法

1. テスト環境にアクセス: `https://dev.bonsai-app.example.com`
2. Cypressテストの実行: `npm run cypress:open`
3. テスト結果の確認: Cypressダッシュボードまたはテストレポート

## 認証テスト

### TC-AUTH-001: ユーザー登録

**目的**: 新規ユーザーが正常に登録できることを確認する

**前提条件**:
- テスト用のメールアドレス（未登録）

**テストステップ**:
1. アプリケーションのサインアップページにアクセスする
2. 必要な情報（名前、メールアドレス、パスワード）を入力する
3. サインアップボタンをクリックする
4. 確認コード入力画面が表示されることを確認する
5. テスト用メールアドレスに送信された確認コードを入力する
6. 確認ボタンをクリックする

**期待結果**:
- ユーザーが正常に登録される
- ログイン画面にリダイレクトされる
- 成功メッセージが表示される

### TC-AUTH-002: ユーザーログイン

**目的**: 登録済みユーザーが正常にログインできることを確認する

**前提条件**:
- 登録済みのテストユーザーアカウント

**テストステップ**:
1. アプリケーションのログインページにアクセスする
2. メールアドレスとパスワードを入力する
3. ログインボタンをクリックする

**期待結果**:
- ユーザーが正常にログインされる
- ダッシュボード画面にリダイレクトされる
- ユーザー情報が正しく表示される

### TC-AUTH-003: パスワードリセット

**目的**: ユーザーがパスワードを忘れた場合に正常にリセットできることを確認する

**前提条件**:
- 登録済みのテストユーザーアカウント

**テストステップ**:
1. アプリケーションのログインページにアクセスする
2. 「パスワードを忘れた場合」リンクをクリックする
3. メールアドレスを入力する
4. 送信ボタンをクリックする
5. テスト用メールアドレスに送信されたリセットコードを入力する
6. 新しいパスワードを入力する
7. パスワード変更ボタンをクリックする

**期待結果**:
- パスワードが正常に変更される
- ログイン画面にリダイレクトされる
- 成功メッセージが表示される
- 新しいパスワードでログインできる

### TC-AUTH-004: ログアウト

**目的**: ユーザーが正常にログアウトできることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション

**テストステップ**:
1. アプリケーションのヘッダーメニューからログアウトオプションを選択する

**期待結果**:
- ユーザーセッションが終了する
- ログイン画面にリダイレクトされる
- 保護されたページにアクセスできなくなる

## プロジェクト管理テスト

### TC-PROJ-001: プロジェクト作成

**目的**: ユーザーが新しいプロジェクトを作成できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション

**テストステップ**:
1. ダッシュボード画面から「新規プロジェクト」ボタンをクリックする
2. プロジェクト名、説明、ステータスを入力する
3. 作成ボタンをクリックする

**期待結果**:
- プロジェクトが正常に作成される
- プロジェクト一覧に新しいプロジェクトが表示される
- 成功メッセージが表示される

### TC-PROJ-002: プロジェクト編集

**目的**: ユーザーが既存のプロジェクトを編集できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用のプロジェクト

**テストステップ**:
1. プロジェクト一覧から対象のプロジェクトを選択する
2. 編集ボタンをクリックする
3. プロジェクト名、説明、ステータスを変更する
4. 保存ボタンをクリックする

**期待結果**:
- プロジェクトが正常に更新される
- 変更された情報がプロジェクト詳細画面に反映される
- 成功メッセージが表示される

### TC-PROJ-003: プロジェクト削除

**目的**: ユーザーが既存のプロジェクトを削除できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用のプロジェクト

**テストステップ**:
1. プロジェクト一覧から対象のプロジェクトを選択する
2. 削除ボタンをクリックする
3. 確認ダイアログで「削除」を選択する

**期待結果**:
- プロジェクトが正常に削除される
- プロジェクト一覧から削除されたプロジェクトが表示されなくなる
- 成功メッセージが表示される

### TC-PROJ-004: プロジェクト詳細表示

**目的**: プロジェクト詳細画面に正しい情報が表示されることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用のプロジェクト（タスクを含む）

**テストステップ**:
1. プロジェクト一覧から対象のプロジェクトをクリックする

**期待結果**:
- プロジェクト詳細画面が表示される
- プロジェクト名、説明、ステータスが正しく表示される
- プロジェクトに関連するタスク一覧が表示される
- プロジェクトの進捗状況が正しく表示される

## タスク管理テスト

### TC-TASK-001: タスク作成

**目的**: ユーザーが新しいタスクを作成できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用のプロジェクト

**テストステップ**:
1. プロジェクト詳細画面から「新規タスク」ボタンをクリックする
2. タスクのタイトル、説明、ステータス、担当者、期限を入力する
3. 作成ボタンをクリックする

**期待結果**:
- タスクが正常に作成される
- タスク一覧に新しいタスクが表示される
- 成功メッセージが表示される

### TC-TASK-002: タスク編集

**目的**: ユーザーが既存のタスクを編集できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用のタスク

**テストステップ**:
1. タスク一覧から対象のタスクを選択する
2. 編集ボタンをクリックする
3. タスクのタイトル、説明、ステータス、担当者、期限を変更する
4. 保存ボタンをクリックする

**期待結果**:
- タスクが正常に更新される
- 変更された情報がタスク詳細画面に反映される
- 成功メッセージが表示される

### TC-TASK-003: タスクステータス変更

**目的**: ユーザーがタスクのステータスを変更できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用のタスク

**テストステップ**:
1. タスク一覧から対象のタスクを選択する
2. ステータスドロップダウンから新しいステータスを選択する
3. 変更を確定する

**期待結果**:
- タスクのステータスが正常に更新される
- 変更されたステータスがタスク一覧とタスク詳細画面に反映される
- タスクのステータスが「完了」に変更された場合、プロジェクトの進捗状況が更新される

### TC-TASK-004: タスク削除

**目的**: ユーザーが既存のタスクを削除できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用のタスク

**テストステップ**:
1. タスク一覧から対象のタスクを選択する
2. 削除ボタンをクリックする
3. 確認ダイアログで「削除」を選択する

**期待結果**:
- タスクが正常に削除される
- タスク一覧から削除されたタスクが表示されなくなる
- 成功メッセージが表示される

### TC-TASK-005: タスク担当者変更

**目的**: ユーザーがタスクの担当者を変更できることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用のタスク
- 複数のテストユーザー

**テストステップ**:
1. タスク詳細画面から編集ボタンをクリックする
2. 担当者ドロップダウンから新しい担当者を選択する
3. 保存ボタンをクリックする

**期待結果**:
- タスクの担当者が正常に更新される
- 変更された担当者情報がタスク詳細画面に反映される
- 新しい担当者に通知が送信される

## 通知テスト

### TC-NOTIF-001: タスク割り当て通知

**目的**: タスクが割り当てられた際に通知が正しく送信されることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション（ユーザーA）
- 別のテストユーザー（ユーザーB）

**テストステップ**:
1. ユーザーAがタスクを作成し、担当者としてユーザーBを選択する
2. ユーザーBのアカウントでログインする

**期待結果**:
- ユーザーBの通知一覧に新しいタスク割り当て通知が表示される
- 通知の内容がタスクの詳細と一致する
- 通知をクリックすると、対応するタスク詳細画面に遷移する

### TC-NOTIF-002: タスク期限通知

**目的**: タスクの期限が近づいた際に通知が正しく送信されることを確認する

**前提条件**:
- テスト用のタスク（期限が設定されている）
- タスクの担当者としてログイン済みのテストユーザーセッション

**テストステップ**:
1. タスクの期限を現在時刻から24時間後に設定する
2. システム時間を23時間進める（テスト環境で模擬）

**期待結果**:
- ユーザーの通知一覧に期限間近の通知が表示される
- 通知の内容がタスクの詳細と一致する
- 通知をクリックすると、対応するタスク詳細画面に遷移する

## オフライン機能テスト

### TC-OFFLINE-001: オフライン編集

**目的**: オフライン状態でデータを編集し、オンライン復帰時に同期されることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用のプロジェクトとタスク

**テストステップ**:
1. ネットワーク接続を切断する（ブラウザのデベロッパーツールで模擬）
2. タスクのステータスを変更する
3. ネットワーク接続を復元する
4. アプリケーションを数秒間操作する

**期待結果**:
- オフライン状態でタスクのステータスが変更できる
- オンライン復帰時に変更が自動的にサーバーと同期される
- 同期完了後、他のブラウザセッションでも変更が反映される

### TC-OFFLINE-002: オフライン作成

**目的**: オフライン状態で新しいデータを作成し、オンライン復帰時に同期されることを確認する

**前提条件**:
- ログイン済みのテストユーザーセッション
- テスト用のプロジェクト

**テストステップ**:
1. ネットワーク接続を切断する（ブラウザのデベロッパーツールで模擬）
2. 新しいタスクを作成する
3. ネットワーク接続を復元する
4. アプリケーションを数秒間操作する

**期待結果**:
- オフライン状態で新しいタスクが作成できる
- オンライン復帰時に新しいタスクが自動的にサーバーと同期される
- 同期完了後、他のブラウザセッションでも新しいタスクが表示される

## パフォーマンステスト

### TC-PERF-001: ページロード時間

**目的**: 各主要ページのロード時間が許容範囲内であることを確認する

**前提条件**:
- テスト環境にデプロイされたアプリケーション
- パフォーマンス測定ツール（Lighthouse、WebPageTest等）

**テストステップ**:
1. 以下の各ページにアクセスし、ロード時間を測定する
   - ログインページ
   - ダッシュボード
   - プロジェクト一覧
   - プロジェクト詳細
   - タスク詳細

**期待結果**:
- 初回ロード時間: 3秒以内
- キャッシュ済みロード時間: 1秒以内
- First Contentful Paint: 1.5秒以内
- Time to Interactive: 3.5秒以内

### TC-PERF-002: 大量データ処理

**目的**: アプリケーションが大量のデータを効率的に処理できることを確認する

**前提条件**:
- テスト環境にデプロイされたアプリケーション
- 大量のテストデータ（100プロジェクト、1000タスク）

**テストステップ**:
1. プロジェクト一覧ページにアクセスする
2. タスク一覧ページにアクセスする
3. フィルタリングと検索機能を使用する

**期待結果**:
- プロジェクト一覧の表示時間: 2秒以内
- タスク一覧の表示時間: 2秒以内
- フィルタリング操作のレスポンス時間: 1秒以内
- ページネーションのレスポンス時間: 1秒以内
- メモリ使用量が許容範囲内である
